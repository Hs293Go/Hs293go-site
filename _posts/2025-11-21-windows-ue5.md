# UE5 Development on Windows For developers from a Linux world

## Installing developer tools

As developers from a linux, we prefer package managers over GUI installers. 
In the windows world, we use a combination of `winget`, which can wrap over any `msi` installer and install heavy monolithic apps not obeying the linux philosophy, and `scoop` to install small CLI tools deterministically and with version-locking.

### Winget

`winget` is built into windows.

We can start by installing Visual Studio

``` pwsh
winget install -e --id Microsoft.VisualStudio.2022.Community
```

### Scoop

Install `scoop` itself by:

``` pwsh
Set-ExecutionPolicy -ExecutionPolicy RemoteSigned -Scope CurrentUser
Invoke-RestMethod -Uri https://get.scoop.sh | Invoke-Expression
```

Install the new crop of cross-platform linux-like CLI tools:

``` pwsh
scoop install ripgrep fd bat
```

## Adding UnrealBuildTool to your path

`UnrealBuildTool.exe` is perhaps the most useful CLI tool in our arsenal. 
We can add it to the `$PATH` to avoid having to quality each call to it with its full path.
Open your powershell profile by running `notepad $PROFILE` (or better, `nvim $PROFILE`), then add the following snippet:

``` pwsh
$ubtPath = "C:\Program Files\Epic Games\UE_5.5\Engine\Binaries\DotNET\UnrealBuildTool"
if ($Env:Path -notlike "*$ubtPath*") { 
  $Env:Path += ";$ubtPath"
}
```

## Generating Visual Studio Project Files

Most tutorials advise us to generate Visual Studio `.sln` project files by right-clicking on the `.uproject` file and selecting the "Generate Visual Studio Project Files" option.

However, I'm convinced this approach is inherently flawed. 
Initiating project file generation this way makes the process almost opaque --- a window with a progress bar and a *show logs* button appears very briefly and vanishes afterwards.

Inability to see logs becomes **fatal** when you know that the project generator continues even if it encounters errors, producing a `.sln` file that is **wrong** and could cause Visual Studio to hang when trying to open the project, leading to the dreaded unending _Preparing solution_ screen.

> [!NOTE]
>
> One such error is not adding any C++ source code to a module (In my case, creating a purely external module, but listing it in the `"Plugins"` section of my `.uproject`. See: https://forums.unrealengine.com/t/module-ubt-error-moduletype-external/241246)

On the other hand, the "Generate ..." button may vanish into thin air.
This is because the mere existence of the button depends on the registration of Unreal Engine installations and file associations, which have a track record of spontaneously becoming invalid on my machine.
Reddit threads and forum answers variously suggest running `UnrealVersionSelector.exe /register` and `UnrealVersionSelector.exe -fileassociations` to reestablish these registrations, in various orders, with various combinations of flags, and from various working directories.

Cue the CLI version of generating Visual Studio project files (**All credits go to https://forums.unrealengine.com/t/generate-vs-project-files-by-command-line/277707**):

``` pwsh
UnrealBuildTool.exe -projectfiles -project="$PWD\HelloUnreal.uproject" -game -rocket -progress
```


whose gorgeous output is:

``` txt
Log file: C:\Users\Hs293Go\AppData\Local\UnrealBuildTool\Log_GPF.txt

Generating VisualStudio project files:
Discovering modules, targets and source code for project...
Binding IntelliSense data...
@progress 'Binding IntelliSense data...' 0%
@progress 'Binding IntelliSense data...' 50%
@progress 'Binding IntelliSense data...' 100%
Binding IntelliSense data... 100%
Writing project files...
@progress 'Writing project files...' 0%
@progress 'Writing project files...' 33%
@progress 'Writing project files...' 67%
@progress 'Writing project files...' 100%
Writing project files... 100%

Generating QueryTargets data for editor...
Total execution time: 54.87 seconds
```

## Generating `compile_commands.json`

[`clangd`](https://clangd.llvm.org/) is a very popular language server that provides fast and effective autocompletion and code exploration. 
It is one of the premier C++ language server in neovim, and veterans of C++ development in VScode are often advised to ditch Microsoft's C++ extension's Intellisense for [vscode-clangd](https://marketplace.visualstudio.com/items?itemName=llvm-vs-code-extensions.vscode-clangd).
(Visual Studio's intellisense is much more powerful at the cost of being slower and more resource-intensive, and we won't discuss it here.)

Much of clangd's power comes from using `compile_commands.json` to understand the exact configuration the code is compiled with. Generating this file with CMake is trivial: just pass in `CMAKE_EXPORT_COMPILE_COMMANDS=ON`. VSCode's CMake extension even generates this file automatically. 

On the other hand, I haven't found the appropriate setting to teach Unreal's build system to generate this file. Fortunately, I found a one-liner to generate it:

``` pwsh
UnrealBuildTool.exe -Mode=GenerateClangDatabase -Target=UnrealEditor Development Win6
```

The command will generate some output like:

``` txt
Creating target...
Available x64 toolchains (1):
 * C:\Program Files\LLVM
    (Family=21, FamilyRank=2, Version=21.1.5, Is64Bit=True, ReleaseChannel=Any, Architecture=x64)
Clang compiler version 21.1.5 is not a preferred version. Please use the latest preferred version 18.1.3
Library 'C:\Program Files\Epic Games\UE_5.5\Engine\Source\ThirdParty\ICU\icu4c-64_1\lib\Win64\Clang\Release\icu.lib' was not resolvable to a file when used in Module 'ICU', assuming it is a filename and will search library paths for it. This is slow and dependency checking will not work for it. Please update reference to be fully qualified alternatively use PublicSystemLibraryPaths if you do intended to use this slow path to suppress this warning.
Parsing headers for UnrealEditor
  Running Internal UnrealHeaderTool UnrealEditor "C:\Program Files\Epic Games\UE_5.5\Engine\Intermediate\Build\Win64\UnrealEditor\Development\UnrealEditor.uhtmanifest" -WarningsAsErrors -installed
Log file: C:\Users\Hs293Go\AppData\Local\UnrealHeaderTool\Saved\Logs\UnrealHeaderTool.log
Total of 0 written
Reflection code generated for UnrealEditor in 1.7379547 seconds
Filtering compile actions...
Writing database...
ClangDatabase written to C:\Program Files\Epic Games\UE_5.5\compile_commands.json
Total execution time: 37.99 seconds
```

Curiously, this command always puts the outputted `compile_commands.json` into the Unreal Engine folder. 
So our final step is to copy `C:\Program Files\Epic Games\UE_5.5\compile_commands.json` into our project.
